<!DOCTYPE HTML>
<html>

<head>
	<title>Image Bed</title>
	<link rel="icon" href="./favicon.ico" type="image/x-icon">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="referrer" content="no-referrer" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script
		type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
	<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
	<link href="css/style.css" rel='stylesheet' type='text/css' />
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/clipboard.min.js"></script>
	<script src="./js/up.itorr.js"></script>
	<script src="./js/clipboard.min.js"></script>
	<script>
		//自定义弹框
		function Toast(msg, duration) {
			duration = isNaN(duration) ? 3000 : duration;
			var m = document.createElement('div');
			m.innerHTML = msg;
			m.style.cssText = "width: 60%;min-width: 150px;opacity: 0.7;height: 40px;color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 5px;position: fixed;top: 40%;left: 20%;z-index: 999999;background: rgb(0, 0, 0);font-size: 13px;";
			document.body.appendChild(m);
			setTimeout(function () {
				var d = 0.5;
				m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
				m.style.opacity = '0';
				setTimeout(function () { document.body.removeChild(m) }, d * 1000);
			}, duration);
		}
	</script>
	<script>
		$(function () {
			// $.ajaxSettings.async = false; // 取消异步
			var paste_image = null;

			function upload_success(response) {
				Toast(response.msg)
				var url = response.url
				show_image.src = url;
				link.href = url;
				inner_content = '<div class="desc">' +
					'<span class="desc1" id="info"><h4>以下是分别是 原始、UBB 和 MD 链接：</h4></span>' +
					'<div class="input_box">' +
					'<input type="text" class="in" id="url_1" readonly="true" data-clipboard-target="p" onfocus="this.select()" value=' + url + ' />' +
					'<button class="btn" data-clipboard-action="copy" data-clipboard-target="#url_1">复制</button>' +
					'</div>' +
					'<div class="input_box">' +
					'<input type="text" class="in" id="url_2" readonly="true" data-clipboard-target="p" onfocus="this.select()" value=' + '[img]' + url + '[/img] />' +
					'<button class="btn" data-clipboard-action="copy" data-clipboard-target="#url_2">复制</button>' +
					'</div>' +
					'<div class="input_box">' +
					'<input type="text" class="in" id="url_3" readonly="true" data-clipboard-target="p" onfocus="this.select()" value=' + '![image](' + url + ') />' +
					'<button class="btn" data-clipboard-action="copy" data-clipboard-target="#url_3">复制</button>' +
					'</div>';
				$('.inner_html').html(inner_content);
			};

			function upload_error() {
				Toast('上传文件出错了！')
			};

			function uploading(process) {
				$('.inner_html').html('<div class="desc1">上传进度为：' + (process * 99).toFixed(2) + ' %');
				$('#show_image').load(function () {
					window.location.href = '#info';
				})
			};

			//  将粘贴事件绑定到 document 上
			document.addEventListener("paste", function (e) {
				var items = event.clipboardData && event.clipboardData.items;
				var file = null;
				if (items && items.length) {
					// 检索剪切板items中类型带有image的
					for (var i = 0; i < items.length; i++) {
						if (items[i].type.indexOf('image') !== -1) { // 或者 items[i].type.indexOf('image') !== -1
							file = items[i].getAsFile(); // 此时file就是剪切板中的图片文件
							break;
						}
					}
				};
				console.log(file);
				if (file) {
					render_paste_image(file);
				} else {
					Toast('从剪贴板中没有找到图片!');
				};

			}, false);

			// 提供剪贴板预览
			function render_paste_image(file) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = function (e) {
					var confirm_upload_button = '<button id="paste_upload_button" class="btn" style="float:right; margin-right: 20px; margin-top: 5px; margin-bottom: 5px;">确定上传</button>';
					$('.inner_html').html(confirm_upload_button);
					$('#show_image').attr("src", e.target.result);
					paste_image = file;  // 赋值给全局变量
				}
			};

			// 点击确定上传按钮(动态元素绑定事件),
			// 使用下面的注册失败，要先绑定在body上
			// $('#paste_upload_button').on('click', function () {
			$('body').on('click', '#paste_upload_button', function () {
				if (paste_image) {
					//  上传
					UP(paste_image, upload_success, upload_error, uploading);
				}
			});

			$('.upload_area').click(function () {
				$('.file_upload').click();
			})

			$('.file_upload').change(function () {
				if (!this.files || !this.files[0])
					return alert('删除成功！或选取文件出错！')
				var this_image_file = this.files[0]
				if (this_image_file.type.indexOf('image') != 0)
					return alert('这不是一个图像或音频！')
				//  上传
				UP(this_image_file, upload_success, upload_error, uploading);
			});

			var clipboard = new ClipboardJS('.btn');
			clipboard.on('success', function (e) {
				Toast("已成功复制剪贴板！", 1500);
			});
			clipboard.on('error', function (e) {
				Toast("复制失败，请手动选择进行复制!", 1500);
			});
		});
	</script>
	<script src="js/menu_jquery.js"></script>
</head>

<body>
	<div class="header">
		<div class="container">
			<div class="logo">
				<h1><a href="#">Image Bed</a></h1>
			</div>

			<div class="clearfix"></div>
		</div>
	</div>
	<div class="banner">
		<div class="container">
			<div class="span_1_of_1">
				<h2>Photos, illustrations by<br> Creatives all over the world.</h2>
				<div class="search">
					<div class="upload_area" id="upload_area">
						Click Me and Upload
					</div>
				</div>
			</div>
		</div>
	</div>
	<input type="file" class="file_upload" id="file_upload" style="opacity: 0;display:none" accept="image/*" />
	<div class="inner_html" id="inner_html">
		<!-- <span class="desc2"><h6>允许上传的图片类型JPG、JPEG、PNG、GIF；图片大小 6M 以内。</h6></span> -->
	</div>

	<a href="" id="link">
		<div class="img_uped_show"><img id="show_image"></div>
	</a>

	<!-- <div class="grid_1"> -->
	<h3 class="bottom_h3">Simple Image Uploader.</h3>

	<!-- <div class="col-md-2 col_1"> -->

	<!-- </div> -->

	<div class="grid_3">
		<div class="container">
			<ul id="footer-links">
				<li><a href="javascript:void(0)">Support</a></li>
				<li><a href="javascript:void(0)">FAQ</a></li>
				<li><a href="javascript:void(0)">Contact Me</a></li>
			</ul>
			<p>Copyright &copy; 2020. All rights reserved.<a target="_blank" href="#"></a></p>
		</div>
	</div>
</body>

</html>